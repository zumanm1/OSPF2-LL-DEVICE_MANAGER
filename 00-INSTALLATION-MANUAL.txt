# NetMan OSPF Device Manager - Clone & Setup Instructions (Ubuntu 24.04)

## GitHub Repository
**URL**: https://github.com/zumanm1/OSPF2-LL-DEVICE_MANAGER

**Version**: 3.1 (November 28, 2025)
**Tested On**: Ubuntu 24.04.2 LTS (VM 172), Ubuntu 24.04.3 LTS (VM 173)

---

## Quick Install (Recommended - Fresh Ubuntu Server)

**For NEW Ubuntu servers - fully automated, no babysitting required:**

### One Command Install (7-Phase Automated)
```bash
git clone https://github.com/zumanm1/OSPF2-LL-DEVICE_MANAGER.git
cd OSPF2-LL-DEVICE_MANAGER
chmod +x *.sh netman.py
./install.sh --clean
./start.sh
```

This will automatically:
- Phase 1: Remove old Node.js
- Phase 2: Remove old npm
- Phase 3: Clean Python environment
- Phase 4: Install Python 3.12
- Phase 5: Install uv package manager
- Phase 6: Install Node.js 20.x
- Phase 7: Install all app dependencies + validate

---

## Quick Install (Existing System)

**Assumes Node.js, npm, Python3, and git are already installed.**

### Step 1: Clone Repository
```bash
git clone https://github.com/zumanm1/OSPF2-LL-DEVICE_MANAGER.git
cd OSPF2-LL-DEVICE_MANAGER
```

### Step 2: Run Smart Installer
```bash
chmod +x *.sh netman.py && ./install.sh
```

### Step 3: Start Application
```bash
./start.sh
```

### Step 4: Access & Login
- **URL:** http://localhost:9050
- **Username:** `admin`
- **Password:** `admin123`

### Step 5: Verify (Optional)
```bash
python3 netman.py status
```

---

## One-Liner Install (Node.js/Python Already Installed)

```bash
git clone https://github.com/zumanm1/OSPF2-LL-DEVICE_MANAGER.git && cd OSPF2-LL-DEVICE_MANAGER && chmod +x *.sh && ./install.sh && ./start.sh
```

---

## One-Liner Install (Fresh Ubuntu 24.04 System - RECOMMENDED)

```bash
git clone https://github.com/zumanm1/OSPF2-LL-DEVICE_MANAGER.git && cd OSPF2-LL-DEVICE_MANAGER && chmod +x *.sh && ./install.sh --clean && ./start.sh
```

**The `--clean` option handles everything automatically - no prerequisites needed!**

**Default Login:** `admin` / `admin123`

---

## Architecture Overview

| Component | Port | Technology | Description |
|-----------|------|------------|-------------|
| Frontend | 9050 | React + Vite | Web UI with real-time updates |
| Backend | 9051 | FastAPI + Python | REST API + WebSocket |
| Database | - | SQLite | Device, user, topology data |

---

## Prerequisites Check

### Manual Verification
```bash
node --version      # Required: v18+ (v20 recommended)
npm --version       # Required: 9+
python3 --version   # Required: 3.10+
git --version       # Required: 2.x+
```

### Automated Check
```bash
python3 netman.py check
```

---

## Install Prerequisites (Ubuntu 24.04)

```bash
# Update system
sudo apt update && sudo apt upgrade -y

# Install Node.js 20.x
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Install Python and tools
sudo apt install -y python3 python3-pip python3-venv git curl
```

---

## Script Commands Reference

| Script | Command | Description |
|--------|---------|-------------|
| **Clean Install** | `./install.sh --clean` | **RECOMMENDED** Full 7-phase automated install |
| Install | `./install.sh` | Smart 8-step install (auto-installs uv, skips existing) |
| Install + Deps | `./install.sh --with-deps` | Also installs Node.js/Python (fixes arch mismatch) |
| Force Install | `./install.sh --force` | Reinstall everything |
| Start | `./start.sh` | Start both servers |
| Start (Force) | `./start.sh --force` | Force restart without prompts |
| Stop | `./stop.sh` | Stop all services |
| Restart | `./restart.sh` | Restart all services |
| Reset Auth | `./reset.sh --auth` | Reset login count |
| Reset DB | `./reset.sh --db` | Clear device database |
| Reset All | `./reset.sh --all` | Full factory reset |

### Install Options Explained

| Option | Use Case |
|--------|----------|
| `--clean` | Fresh Ubuntu server, removes old installations first |
| `--with-deps` | Existing system missing Node.js/Python |
| `--force` | Reinstall all components even if they exist |
| (no option) | App dependencies only, assumes tools installed |

---

## Installation Steps (8 Steps)

The `./install.sh` script performs these 8 steps automatically:

| Step | Description |
|------|-------------|
| 1/8 | Check system dependencies |
| 2/8 | Verify required tools (Node.js, npm, Python3, Git) |
| 3/8 | Install frontend dependencies (npm) |
| 4/8 | Install uv package manager (auto-installed if missing) |
| 5/8 | Create Python virtual environment (using uv) |
| 6/8 | Install Python dependencies (using uv - 10-100x faster) |
| 7/8 | Create configuration files |
| 8/8 | Validate installation |

**Note:** uv is automatically installed if not present. No manual installation required.

---

## Python Manager Commands

| Command | Description |
|---------|-------------|
| `python3 netman.py check` | Verify system requirements |
| `python3 netman.py install` | Smart install (skips existing) |
| `python3 netman.py install --force` | Force reinstall all |
| `python3 netman.py start` | Start services |
| `python3 netman.py stop` | Stop services |
| `python3 netman.py restart` | Restart services |
| `python3 netman.py status` | Check if services running |
| `python3 netman.py logs` | View logs |
| `python3 netman.py logs -f` | Follow logs in real-time |
| `python3 netman.py reset --target auth` | Reset login count |
| `python3 netman.py reset --target db` | Clear device database |

---

## Manual Installation Steps

### Step 1: Stop Any Running Instances
```bash
lsof -ti:9050,9051 | xargs kill -9 2>/dev/null
echo "Ports cleared"
```

### Step 2: Clone Repository
```bash
cd ~
git clone https://github.com/zumanm1/OSPF2-LL-DEVICE_MANAGER.git
cd OSPF2-LL-DEVICE_MANAGER
```

### Step 3: Install Frontend Dependencies
```bash
npm install
```

### Step 4: Setup Python Virtual Environment
```bash
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
cd ..
```

### Step 5: Create Configuration
```bash
mkdir -p logs backend/data/executions
```

### Step 6: Start Services
```bash
# Terminal 1 - Backend
cd backend && source venv/bin/activate && python3 server.py

# Terminal 2 - Frontend
npm run dev
```

---

## Run in Background

```bash
# Start both servers in background
./start.sh

# Or manually:
cd backend && source venv/bin/activate && nohup python3 server.py > ../logs/backend.log 2>&1 &
cd .. && nohup npm run dev > logs/frontend.log 2>&1 &

# Check status
python3 netman.py status

# View logs
tail -f logs/backend.log logs/frontend.log

# Stop all
./stop.sh
```

---

## Security Features

| Feature | Description |
|---------|-------------|
| Session Auth | Cookie-based session tokens |
| Password Hashing | SHA-256 with salt |
| Login Limits | Configurable max logins (default: 10) |
| Role-Based Access | Admin, Operator, Viewer roles |
| Localhost Only | Restrict API to local access (configurable) |
| Jumphost Support | Route through SSH bastion host |

---

## User Roles

| Role | Permissions |
|------|-------------|
| Admin | Full access: users, devices, automation, settings |
| Operator | Manage devices, run automation, view settings |
| Viewer | Read-only access |

---

## Configuration File

Edit `backend/.env.local`:

| Variable | Default | Description |
|----------|---------|-------------|
| `SECURITY_ENABLED` | true | Enable authentication |
| `APP_USERNAME` | admin | Default username |
| `APP_PASSWORD` | admin123 | Default password |
| `APP_LOGIN_MAX_USES` | 10 | Max logins before expiry |
| `APP_SESSION_TIMEOUT` | 3600 | Session timeout (seconds) |
| `LOCALHOST_ONLY` | true | Restrict to localhost |
| `JUMPHOST_ENABLED` | false | Enable SSH jumphost |

---

## Firewall Configuration (Remote Access)

```bash
# Allow frontend port
sudo ufw allow 9050/tcp comment "NetMan Frontend"

# Allow backend port
sudo ufw allow 9051/tcp comment "NetMan Backend"

# Apply changes
sudo ufw reload

# Verify
sudo ufw status | grep 905
```

---

## Update to Latest Version

```bash
cd ~/OSPF2-LL-DEVICE_MANAGER

# Stop services
./stop.sh

# Pull latest code
git pull origin main

# Update dependencies
./install.sh

# Restart
./start.sh
```

---

## Fresh Reinstall (Complete Reset)

```bash
# Stop, remove, clone, install, start
lsof -ti:9050,9051 | xargs kill -9 2>/dev/null
rm -rf ~/OSPF2-LL-DEVICE_MANAGER
git clone https://github.com/zumanm1/OSPF2-LL-DEVICE_MANAGER.git ~/OSPF2-LL-DEVICE_MANAGER
cd ~/OSPF2-LL-DEVICE_MANAGER && chmod +x *.sh && ./install.sh && ./start.sh
```

---

## Troubleshooting

### Node.js exec format error (wrong architecture)
```bash
# Check system architecture
uname -m

# Remove wrong-architecture Node.js
sudo apt-get remove -y nodejs npm
sudo rm -rf /usr/bin/node /usr/bin/npm /usr/lib/node_modules

# Install correct architecture
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# Verify
node --version
```

### npm install fails
```bash
npm cache clean --force
rm -rf node_modules package-lock.json
npm install
```

### Port already in use
```bash
lsof -ti:9050,9051 | xargs kill -9 2>/dev/null
./start.sh
```

### Password expired / Login count exceeded
```bash
./reset.sh --auth
./restart.sh
```

### Backend won't start
```bash
tail -f logs/backend.log
# Check Python venv
source backend/venv/bin/activate
python3 -c "import fastapi; print('OK')"
```

### Permission denied
```bash
chmod +x *.sh netman.py
```

### Database errors
```bash
./reset.sh --db
./restart.sh
```

---

## Quick Reference

| Action | Command |
|--------|---------|
| Clone | `git clone https://github.com/zumanm1/OSPF2-LL-DEVICE_MANAGER.git` |
| Install | `./install.sh` |
| Start | `./start.sh` |
| Stop | `./stop.sh` |
| Restart | `./restart.sh` |
| Status | `python3 netman.py status` |
| Logs | `python3 netman.py logs -f` |
| Reset Auth | `./reset.sh --auth` |
| Reset All | `./reset.sh --all` |
| Health Check | `curl http://localhost:9051/api/auth/status` |

---

## Access URLs

| Service | URL | Notes |
|---------|-----|-------|
| Frontend UI | http://localhost:9050 | Main application |
| Backend API | http://localhost:9051 | REST API |
| Auth Status | http://localhost:9051/api/auth/status | Health check |
| Network Access | http://YOUR_IP:9050 | Requires firewall rule |

---

## Default Credentials

| Username | Password | Role | Notes |
|----------|----------|------|-------|
| admin | admin123 | Administrator | Change after first login! |

---

## Application Pages

| Page | Description |
|------|-------------|
| Device Manager | Add/edit/delete network devices |
| Automation | Run commands on multiple devices |
| Data Save | View saved configurations |
| Transformation | Parse CDP/neighbor data |
| Interface Costs | OSPF cost calculator |
| OSPF Designer | Network topology visualization |
| Traffic Analysis | Interface traffic charts |

---

## Support

- **Repository**: https://github.com/zumanm1/OSPF2-LL-DEVICE_MANAGER
- **Issues**: https://github.com/zumanm1/OSPF2-LL-DEVICE_MANAGER/issues

---

## Verified Test Results (November 28, 2025)

### Dual VM Testing Summary

| VM | IP | OS Version | Duration | Status |
|----|-----|------------|----------|--------|
| VM 172 | 172.16.39.172 | Ubuntu 24.04.2 LTS | 81 sec | ✅ PASS |
| VM 173 | 172.16.39.173 | Ubuntu 24.04.3 LTS | 115 sec | ✅ PASS |

### Validated Components

| Component | Version | Status |
|-----------|---------|--------|
| Node.js | v20.19.6 | ✅ |
| npm | 10.8.2 | ✅ |
| Python | 3.12.3 | ✅ |
| uv | 0.9.13 | ✅ |
| fastapi | 0.104.1 | ✅ |
| uvicorn | 0.24.0 | ✅ |
| netmiko | 4.3.0 | ✅ |
| npm packages | 137 | ✅ |
| Python packages | 31 | ✅ |

### Script Features

- **Retry Logic**: 3 automatic retry attempts for npm and pip installs
- **Fallback Options**: If uv fails, falls back to pip; if npm fails, tries --legacy-peer-deps
- **Non-Interactive Mode**: Auto-detects SSH/cron, no prompts required
- **Health Validation**: Verifies API responds before marking success
- **Auto-Recovery**: Creates venv and installs deps if missing during start

### Quick Validation Commands

```bash
# Check all services
python3 netman.py status

# Verify API health
curl -s http://localhost:9051/api/health

# Expected output: {"status":"OK","database":"connected"}
```

---

*Version 3.1 - Built with Claude Code*
*Last Verified: November 28, 2025*
